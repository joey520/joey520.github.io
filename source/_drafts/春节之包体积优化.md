---
toc: true
title: 春节之包体积优化
date: 2020-02-03 22:20:58
categories:
tags:
---

## 前言

这个春节真是有够长，蹭着没事来做一次MSDK包的优化，MSDK包太大已经被吐槽无数次了，前一段时候才做了把一些限飞数据库资源等变成可选项`bundle`让用户进行下载，甚至把一些功能打包成动态库用于动态加载，则不需要这些功能的用户可以不引入。

但是这还远远不够。当前MSDK编译出来的framework为159.6MB。看看优化后到底能缩小到多少。



## 分析

先看看`DJISDK.Framework`有哪些东西吧:

![image-20200203225942902](/Users/joey.cao/Library/Application Support/typora-user-images/image-20200203225942902.png)

![image-20200203223509635](/Users/joey.cao/Library/Application Support/typora-user-images/image-20200203223509635.png)

可以看到有几个除了动态库`DJISDK`还有几个`bundle`存放着一些资源文件。

### 1.去除无用文件

`xcode`的`build setting`中有一个叫`link map`的选项，当设置`write link map file`为`true`时，`link`的每一个文件都会被记录在`link map`文件下，路径可以参考`path to link map file`。通过这个文件就可以看到所有文件的信息，它把所有link进去的文件都列举了出来包括路径。而且有一个比较实用的GUI工具用于分析`linkmap`。地址为:https://www.jianshu.com/p/ea80df3d4212。它主要是遍历`linkmap`然后找到路径获取文件大小，然后按大小排列，可以方便我们一眼看出来各个文件的大小。

通过对`Mach-O`的分析，我们知道`classlist`和`classrefs`的差集可以一定程度反映类的使用情况，于是我们写一个脚本来对`Mach-O`进行解析:

```

```



### 清理掉无用的framework

在DJISDK的代码中有少量的`swift`代码存在，虽然打出的`Framework`看不出什么端倪，但是如果是一个纯OC的工程在引入`DJISDK`之后会被动加载



## 参考资料

https://github.com/huanxsd/LinkMap (一个用于解析linkmap的GUI工具)